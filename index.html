<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tsunami Of The World</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.5/d3.layout.cloud.js"></script>

    <!-- CSS file -->
    <link rel="stylesheet" type="text/css" href="styles.css" media="all">


</head>
<body>
    <!-- Choropleth Map Container -->
    <div id="choropleth_map"></div>

    <!-- <div id="boxplot"></div> -->

    <div id="top10_boxplot"></div>

    <div id="selected_country_boxplot"></div>

    <div id="horizontal_bar"></div>

    <div id="word_cloud"></div>

    <svg id="word-cloud" width="800" height="400"></svg>  

    <script type="text/javascript">

      var spec1 = "js/choropleth_map.json";
      vegaEmbed('#choropleth_map', spec1).then(function(result) {
        // Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
      }).catch(console.error);

      // var spec2 = "js/boxplot.json";
      // vegaEmbed('#boxplot', spec2).then(function(result) {
      //   // Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
      // }).catch(console.error);

      var spec3 = "js/top10_boxplot.json";
      vegaEmbed('#top10_boxplot', spec3).then(function(result) {
        // Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
      }).catch(console.error);

      var spec4 = "js/selected_country_boxplot.json";
      vegaEmbed('#selected_country_boxplot', spec4).then(function(result) {
        // Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
      }).catch(console.error);

      var spec5 = "js/horizontal_bar.json";
      vegaEmbed('#horizontal_bar', spec5).then(function(result) {
        // Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
      }).catch(console.error);

      // var spec6 = "js/word_cloud.json";
      // vegaEmbed('#word_cloud', spec6).then(function(result) {
      //   // Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
      // }).catch(console.error);

      // word-cloud.js
      d3.json('https://raw.githubusercontent.com/Szeyuinn/FIT3179Assignment/refs/heads/main/cleaned_causes.json').then(function(data) {
        const width = 800;
        const height = 400;

        // Create a scale for font sizes (adjusted range)
        const fontSizeScale = d3.scaleLinear()
            .domain([d3.min(data, d => d.size), d3.max(data, d => d.size)]) // Keep original 'size' for scaling
            .range([10, 80]);

        // Create the layout for the word cloud
        const layout = d3.layout.cloud()
            .size([width, height])
            // Map original 'size' to 'occurrences' for tooltip and use scaled 'size' for font size
            .words(data.map(d => ({ text: d.text, size: fontSizeScale(d.size), occurrences: d.size })))
            .padding(5)
            .rotate(() => Math.random() > 0.5 ? 0 : 90)
            .fontSize(d => d.size)
            .on("end", draw);

        layout.start();

        // Create a tooltip div
        const tooltip = d3.select("body").append("div")
            .style("position", "absolute")
            .style("background-color", "lightgrey")
            .style("border", "1px solid grey")
            .style("padding", "5px")
            .style("border-radius", "3px")
            .style("opacity", 0)
            .style("pointer-events", "none"); // Make it not interfere with mouse events

        function draw(words) {
            d3.select("#word_cloud").selectAll("*").remove(); // Clear previous content

            const svg = d3.select("#word_cloud")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${width / 2}, ${height / 2})`);

            const wordElements = svg.selectAll("text")
                .data(words)
                .enter().append("text")
                .style("font-size", d => d.size + "px")
                .style("fill", (d, i) => d3.schemeCategory10[i % 10])
                .attr("text-anchor", "middle")
                .attr("transform", d => `translate(${d.x}, ${d.y}) rotate(${d.rotate})`)
                .text(d => d.text);

            // Add tooltips on hover using a div
            wordElements
                .on("mouseover", function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", 0.9);
                    // Show original 'occurrences' (before scaling)
                    tooltip.html(`Cause: ${d.text}<br>Occurrences: ${d.occurrences}`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 15) + "px");
                })
                .on("mousemove", function(event) {
                    tooltip.style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 15) + "px");
                })
                .on("mouseout", function() {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", 0);
                });
        }
    }).catch(function(error) {
        console.error('Error loading the data:', error);
    });

    </script>

</body>
</html>
