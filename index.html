<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tsunami Impacts Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.5/d3.layout.cloud.js"></script>

    <!-- CSS file -->
    <link rel="stylesheet" type="text/css" href="styles.css" media="all">
</head>
<body>
    <!-- Main Container -->
    <div class="main-container">

        <!-- Page Title and Description -->
        <div class="page-header">
            <h1 class="serif">Tsunami Impacts Around the World</h1>
            <p>This visualization explores the dramatic impacts of tsunamis across various countries, using diverse data representations such as choropleth maps, boxplots, and word clouds to illustrate the regions most affected by these natural disasters.</p>
        </div>

        <!-- Choropleth Map Section -->
        <!-- <div class="visual-section">
            <h2>Tsunami Impact by Country (Choropleth Map)</h2>
            <p>This map vividly depicts the severity of tsunami impacts by country, with deeper colors representing higher levels of damage and fatalities, allowing for quick visual assessment of risk areas.</p>
            <div id="choropleth_map" class="chart-container choropleth"></div>
        </div> -->

        <!-- Debug Map Section -->
        <div class="visual-section">
            <h2>Tsunami Impact by Year (2000-2014)</h2>
            <p>Note: There are no tsunami occurrences in the years 2001 and 2005.</p>
            <div id="debug_map" class="chart-container choropleth"></div>
        </div>

        <!-- Boxplots Section for Top 10 vs Selected Country -->
        <div class="visual-section">
            <h2>Top 10 Country with Highest Tsunami Runup Heights</h2>
            <div class="top10-comparison">
                <div class="top10-description">
                    <p>Explore how tsunami runup heights vary by country. This comparison highlights the top 10 most affected countries offering insights into the scale of impact.</p>
                    <p>The peak of the line signifies the maximum tsunami height that country has experienced, the line in the box signifies the overall heights of it looking into the past years (since 1800).</p>
                </div>
                <div class="top10-chart-container">
                    <div id="top10_boxplot" class="chart-container top10"></div>
                </div>
            </div>
        </div>


        <!-- Horizontal Bar Chart Section -->
        <!-- <div class="visual-section">
            <h2>Top 10 Deaths Caused by Tsunamis</h2>
            <p>This bar chart presents the primary geological events that lead to tsunamis, clearly illustrating the most frequent causes and providing context for understanding their triggers.</p>
            <div id="horizontal_bar" class="chart-container horizontal-bar"></div>
        </div> -->

        <!-- Horizontal Bar Chart Section -->
        <div class="visual-section">
            <h2>Top 10 Deaths Caused by Tsunamis</h2>
            <div class="horizontal-bar-comparison">
                <div class="horizontal-bar-chart-container">
                    <div id="horizontal_bar" class="chart-container horizontal-bar"></div>
                </div>
                <div class="horizontal-bar-description">
                    <p>This horizontal bar chart illustrates the primary causes of tsunamis around the globe. Each bar represents the frequency of various geological events that lead to tsunamis, shedding light on the most common triggers and the need for monitoring such natural phenomena.</p>
                </div>
            </div>
        </div>

        <!-- Word Cloud Section -->
        <div class="visual-section">
            <h2>Tsunami Causes Word Cloud</h2>
            <p>This visually striking word cloud represents the most common causes of tsunamis, where larger words indicate more frequent causes, making it easy to identify major contributors at a glance.</p>
            <div id="word_cloud" class="chart-container word-cloud"></div>
        </div>

        <div class="visual-section">
            <h2>Tsunami Causes</h2>
            <p>This visually striking word cloud represents the most common causes of tsunamis, where larger words indicate more frequent causes, making it easy to identify major contributors at a glance.</p>
            <div id="tree_map" class="chart-container word-cloud"></div>
        </div>

    </div>

    <script type="text/javascript">
        // var spec1 = "js/choropleth_map.json";
        // vegaEmbed('#choropleth_map', spec1).then(function(result) {
        //     // Access the Vega view instance as result.view
        // }).catch(console.error);

        var spec2 = "js/debug_map.json";
        vegaEmbed('#debug_map', spec2).then(function(result) {
            // Access the Vega view instance as result.view
        }).catch(console.error);

        var spec3 = "js/top10_boxplot.json";
        vegaEmbed('#top10_boxplot', spec3).then(function(result) {
            // Access the Vega view instance as result.view
        }).catch(console.error);

        // var spec4 = "js/selected_country_boxplot.json";
        // vegaEmbed('#selected_country_boxplot', spec4).then(function(result) {
        //     // Access the Vega view instance as result.view
        // }).catch(console.error);

        var spec5 = "js/horizontal_bar.json";
        vegaEmbed('#horizontal_bar', spec5).then(function(result) {
            // Access the Vega view instance as result.view
        }).catch(console.error);

        var spec6 = "js/tree_map.json";
        vegaEmbed('#tree_map', spec6).then(function(result) {
            // Access the Vega view instance as result.view
        }).catch(console.error);

        d3.json('https://raw.githubusercontent.com/Szeyuinn/FIT3179Assignment/refs/heads/main/cleaned_causes.json').then(function(data) {
            const width = 600;
            const height = 300;

            const fontSizeScale = d3.scaleLinear()
                .domain([d3.min(data, d => d.size), d3.max(data, d => d.size)])
                .range([10, 100]);

            const layout = d3.layout.cloud()
                .size([width, height])
                .words(data.map(d => ({ text: d.text, size: fontSizeScale(d.size), occurrences: d.size })))
                .padding(5)
                .rotate(() => Math.random() > 0.5 ? 0 : 90)
                .fontSize(d => d.size)
                .on("end", draw);

            layout.start();

            const tooltip = d3.select("body").append("div")
                .style("position", "absolute")
                .style("background-color", "lightgrey")
                .style("border", "1px solid grey")
                .style("padding", "5px")
                .style("border-radius", "3px")
                .style("opacity", 0)
                .style("pointer-events", "none");

            function draw(words) {
                d3.select("#word_cloud").selectAll("*").remove();

                const svg = d3.select("#word_cloud")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g")
                    .attr("transform", `translate(${width / 2}, ${height / 2})`);

                const wordElements = svg.selectAll("text")
                    .data(words)
                    .enter().append("text")
                    .style("font-size", d => d.size + "px")
                    .style("fill", (d, i) => d3.schemeCategory10[i % 10])
                    .attr("text-anchor", "middle")
                    .attr("transform", d => `translate(${d.x}, ${d.y}) rotate(${d.rotate})`)
                    .text(d => d.text);

                wordElements
                    .on("mouseover", function(event, d) {
                        tooltip.transition()
                            .duration(200)
                            .style("opacity", 0.9);
                        tooltip.html(`Cause: ${d.text}<br>Occurrences: ${d.occurrences}`)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 15) + "px");
                    })
                    .on("mousemove", function(event) {
                        tooltip.style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 15) + "px");
                    })
                    .on("mouseout", function() {
                        tooltip.transition()
                            .duration(200)
                            .style("opacity", 0);
                    });
            }
        }).catch(function(error) {
            console.error('Error loading the data:', error);
        });
    </script>
</body>
</html>
